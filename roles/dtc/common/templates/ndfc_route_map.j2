! This NDFC Route_Control_Route_maps config data structure is auto-generated
! DO NOT EDIT MANUALLY
!
!
    {# Get policy route-maps in groups #}
    {% for policy_name in policy_types["route_maps"] %}
    {# Get route-maps under Route_control #}
        {% for route_map in item["route_maps"]%}
            {# If policy name in Group equal to policy in Route_control #}
            {% if policy_name["name"] == route_map["name"] %}
                {% for entry in route_map["entries"] %}
route-map {{ route_map["name"] | lower }} {{ entry["operation"] }} {{ entry["seq_number"] }}
                    {% if entry["description"] is defined %}
  description {{ entry["description"] }}
                    {% endif %}
                    {% if entry["match"] is defined %}
                        {% for match in entry["match"] %}
                            {% if match["route_types"] is defined %}
  match route-type {{ match["route_types"] | join(" ") }}
                            {% endif %}
                            {% if match["community_list"] is defined %}
                                {% if match["community_list"]["community"] is defined and match["community_list"]["exact_match"] is defined %}
  match community {{ match["community_list"]["community"] }} exact-match
                                {% elif match["community_list"]["community"] is defined %}
  match community {{ match["community_list"]["community"] }}
                                {% endif %}
                            {% endif %}
                            {% if match["extended_community_list"] is defined %}
                                {% if match["extended_community_list"]["community"] is defined and match["extended_community_list"]["exact_match"] is defined %}
  match extcommunity {{ match["extended_community_list"]["community"] }} exact-match
                                {% elif match["extended_community_list"]["community"] is defined %}
  match extcommunity {{ match["extended_community_list"]["community"] }}
                                {% endif %}
                            {% endif %}
                            {% if match["evpn_route_types"] is defined %}
  match evpn route-type {{ match["evpn_route_types"] | unique | join (" ")}}
                            {% endif %}
                            {% if match["as_path_list"] is defined %}
  match as-path {{ match["as_path_list"] }}
                            {% endif %}
                            {% if match["as_numbers"] is defined %}
                                {% set asnumber = [] %}
                                {% for as in match["as_numbers"] %}
                                    {% if as["from"] is defined and as["to"] is defined %}
                                        {% set _ = asnumber.append(as["from"]~ "-" ~as["to"])%}
                                    {% elif as["from"] is defined %}
                                        {% set _ = asnumber.append(as["from"]) %}
                                    {% endif %}
                                {% endfor %}
  match as-number {{ asnumber | join(", ") }}
                            {% endif %}
                            {% if match["interfaces"] is defined %}
  match interface {{ match["interfaces"] | join(" ") }}
                            {% endif %}
                            {% if match["metric"] is defined %}
                                {% if match["metric"]["deviation_operator"] is defined %}
  match metric {{ match["metric"]["metric"] }} {{ match["metric"]["deviation_operator"] }} {{ match["metric"]["deviation_value"] }}
                                {% else %}
  match metric {{ match["metric"]["metric"] }}
                                {% endif %}
                            {% endif %}
                            {% if match["mac_list"] is defined %}
  match mac-list {{ match["mac_list"] }}
                            {% endif %}
                            {% if match["ospf_area"] is defined %}
  match ospf-area {{ match["ospf_area"] }}
                            {% endif %}
                            {% if match["source_protocol"] is defined %}
  match source-protocol {{ match["source_protocol"] }}
                            {% endif %}
                            {% if match["tags"] is defined %}
  match tag {{ match["tags"] | join (" ") }}
                            {% endif %}
                            {% if match["ipv4"] is defined %}
                                {% if match["ipv4"]["address_prefix_list"] is defined %}
  match ip address prefix-list {{ match["ipv4"]["address_prefix_list"] | join(" ") }}
                                {% endif %}
                                {% if match["ipv4"]["next_hop_prefix_list"] is defined %}
  match ip next-hop prefix-list {{ match["ipv4"]["next_hop_prefix_list"] | join(" ") }}
                                {% endif %}
                                {% if match["ipv4"]["route_src_prefix_list"] is defined %}
  match ip route-source prefix-list {{ match["ipv4"]["route_src_prefix_list"] | join(" ") }}
                                {% endif %}
                            {% endif %}
                            {% if match["ipv6"] is defined %}
                                {% if match["ipv6"]["address_prefix_list"] is defined %}
  match ip address prefix-list {{ match["ipv6"]["address_prefix_list"] | join(" ") }}
                                {% endif %}
                                {% if match["ipv6"]["next_hop_prefix_list"] is defined %}
  match ip next-hop prefix-list {{ match["ipv6"]["next_hop_prefix_list"] | join(" ") }}
                                {% endif %}
                                {% if match["ipv6"]["route_src_prefix_list"] is defined %}
  match ip route-source prefix-list {{ match["ipv6"]["route_src_prefix_list"] | join(" ") }}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                    {% if entry["continue"] is defined %}
  continue {{ entry["continue"] }}
                    {% endif %}
                    {% if entry["set"] is defined %}
                        {% for set in entry["set"] %}
                            {# as-path #}
                            {% if set["as_path"] is defined %}
                                {% if set["as_path"]["tag"] is defined and set["as_path"]["tag"] is true %}
  set as-path tag
                                {% elif set["as_path"]["none"] is defined and set["as_path"]["none"] is true %}
  set as-path none
                                {% elif set["as_path"]["local_as"] is defined or set["as_path"]["remote_as"] is defined %}
                                    {% set options = [] %}
                                    {% if set["as_path"]["local_as"] is true %}
                                        {% set _ = options.append("local-as")%}
                                    {% endif %}
                                    {% if set["as_path"]["remote_as"] is true %}
                                        {% set _ = options.append("remote-as")%}
                                    {% endif %}
                                    {% if set["as_path"]["as_number"] is defined %}
                                        {% for as in set["as_path"]["as_number"]%}
                                            {% set _ = options.append(as) %}
                                        {% endfor %}
                                    {% endif %}
  set as-path {{ options | join(" ")}}
                                {# as-path prepend #}
                                {% elif set["as_path"]["prepend"] is defined %}
                                    {% if set["as_path"]["prepend"]["last_as_path_count"] is defined %}
  set as-path prepend last-as {{ set["as_path"]["prepend"]["last_as_path_count"] }}
                                    {% else %}
  set as-path prepend {{ set["as_path"]["prepend"] | join(" ") }}
                                    {% endif %}
                                {# as-path replace #}
                                {% elif set["as_path"]["replace"] is defined %}
                                    {# as-path replace w/ private-as #}
                                    {% if set["as_path"]["replace"]["private_as"] is defined %}
                                        {% if set["as_path"]["replace"]["private_as"] is true %}
  set as-path replace private-as
                                        {% elif set["as_path"]["replace"]["private_as"] == 'none' %}
  set as-path replace private-as with none
                                        {% elif set["as_path"]["replace"]["private_as"] == 'remote-as' %}
  set as-path replace private-as with remote-as
                                        {% else %}
  set as-path replace private-as with {{ set["as_path"]["replace"]["private_as"] }}
                                        {% endif %}
                                    {# as-path replace w/o private-as #}
                                    {% elif set["as_path"]["replace"] is defined and set["as_path"]["as_number"] is defined%}
                                        {% if set["as_path"]["replace"]["as_number"] is defined and set["as_path"]["replace"]["as_number"] == 'none' %}
  set as-path replace {{ set["as_path"]["as_number"] | join(" ") }} with none
                                        {% elif set["as_path"]["replace"]["as_number"] is defined and set["as_path"]["replace"]["as_number"] == 'remote-as' %}
  set as-path replace {{ set["as_path"]["as_number"] | join(" ") }} with remote-as
                                        {% elif set["as_path"]["replace"]["as_number"] is defined %}
  set as-path replace {{ set["as_path"]["as_number"] | join(" ") }} with {{ set["as_path"]["replace"]["as_number"] }}
                                        {% else %}
  set as-path replace {{ set["as_path"]["replace"]["as_number"] | join(" ") }}
                                        {% endif %}
                                    {% endif %}
                                {# if only as-number #}
                                {% elif set["as_path"]["as_number"] is defined %}
  set as-path {{ set["as_path"]["as_number"] | join(" ")}}
                                {% endif %}
                            {% endif %}
                            {# delete keyword doesn't exist #}
                            {% if set["community_list"] is defined %}
  set comm-list {{ set["community_list"] }} delete
                            {% endif %}
                            {% if set["community"] is defined %}
                                {# used to order options properly in CLI #}
                                {# set community internet 65000:42 65000:43 no-export no-advertise local-AS graceful-shutdown blackhole additive #}
                                {% set community_asn = [] %}
                                {% for asn in set["community"] %}
                                    {% if asn not in ['internet','no_export','no_advertise','local_as','graceful_shutdown','blackhole','additive'] %}
                                        {% set _ = community_asn.append(asn) %}
                                    {% endif %}
                                {% endfor %}
                                {% set community_options = [] %}
                                {% if 'internet' in set["community"] %}
                                    {% set _ = community_options.append("internet") %}
                                {% endif %}
                                {% if community_asn | length > 0 %}
                                    {% set _= community_options.append(community_asn | join(" ")) %}
                                {% endif %}
                                {% if 'no_export' in set["community"] %}
                                    {% set _ = community_options.append("no-export") %}
                                {% endif %}
                                {% if 'no_advertise' in set["community"] %}
                                    {% set _ = community_options.append("no-advertise") %}
                                {% endif %}
                                {% if 'local_as' in set["community"] %}
                                    {% set _ = community_options.append("local-AS") %}
                                {% endif %}
                                {% if 'graceful_shutdown' in set["community"] %}
                                    {% set _ = community_options.append("graceful-shutdown") %}
                                {% endif %}
                                {% if 'blackhole' in set["community"] %}
                                    {% set _ = community_options.append("blackhole") %}
                                {% endif %}
                                {% if 'additive' in set["community"] %}
                                    {% set _ = community_options.append("additive") %}
                                {% endif %}
  set community {{ community_options | join(" ") }}
                            {% endif %}
                            {% if set["dampening"] is defined %}
  set dampening {{ set["dampening"]["half_life"] }} {{ set["dampening"]["reuse_penalty"] }} {{ set["dampening"]["suppress_penalty"] }} {{ set["dampening"]["max_suppress_time"] }}
                            {% endif %}
                            {% if set["distance"] is defined %}
                                {% if set["distance"]["igp_ebgp"] is defined and set["distance"]["internal"] is defined and set["distance"]["local"] is defined %}
  set distance {{ set["distance"]["igp_ebgp"] }} {{ set["distance"]["internal"] }} {{ set["distance"]["local"] }}
                                {% elif set["distance"]["igp_ebgp"] is defined and set["distance"]["internal"] is defined %}
  set distance {{ set["distance"]["igp_ebgp"] }} {{ set["distance"]["internal"] }}
                                {% elif set["distance"]["igp_ebgp"] is defined and set["distance"]["internal"] is defined %}
  set distance {{ set["distance"]["igp_ebgp"] }}
                                {% endif %}
                            {% endif %}
                            {% if set["evpn"] is defined and set["evpn"]["gateway_ip"] is defined %}
  set evpn gateway-ip {{ set["evpn"]["gateway_ip"] }}
                            {% endif %}
                            {% if set["extended_community_list"] is defined %}
  set extcomm-list {{ set["extended_community_list"]}} delete
                            {% endif %}
                            {% if set["extended_community"] is defined %}
                                {% if set["extended_community"]["4byteas_generic"] is defined %}
                                    {% set ext_4byte_option = [] %}
                                    {# additive or none #}
                                    {% if set["extended_community"]["4byteas_generic"]["option"] is defined and set["extended_community"]["4byteas_generic"]["transitivity"] is not defined %}
                                        {% set _ = ext_4byte_option.append(set["extended_community"]["4byteas_generic"]["option"]) %}
                                    {% endif %}
                                    {# transitive or none + communities #}
                                    {% if set["extended_community"]["4byteas_generic"]["transitivity"] is defined %}
                                        {% for transitive in set["extended_community"]["4byteas_generic"]["transitivity"] %}
                                            {% if transitive["transitive"] is true %}
                                                {% set _ = ext_4byte_option.append("transitive") %}
                                            {% elif transitive["transitive"] is false %}
                                                {% set _ = ext_4byte_option.append("non-transitive") %}
                                            {% endif %}
                                            {% if transitive["community"] %}
                                                {% set _ = ext_4byte_option.append(transitive["community"]) %}
                                            {% endif %}
                                        {% endfor %}
                                        {% if set["extended_community"]["4byteas_generic"]["option"] is defined and
                                        set["extended_community"]["4byteas_generic"]["option"] == 'additive' %}
                                            {% set _ = ext_4byte_option.append('additive') %}
                                        {% endif %}
                                    {% endif %}
  set extcommunity 4byteas-generic {{ ext_4byte_option | join(" ")}}
                                {% endif %}
                                {# extcommunity w/ color #}
                                {% if set["extended_community"]["color"] is defined %}
                                    {% if set["extended_community"]["color"]["color_community"] is defined and set["extended_community"]["color"]["co_flag"] is defined %}
  set extcommunity color {{ set["extended_community"]["color"]["color_community"] }} co-flag {{ set["extended_community"]["color"]["co_flag"]}}
                                    {% elif set["extended_community"]["color"]["color_community"] is defined %}
  set extcommunity color {{ set["extended_community"]["color"]["color_community"] }}
                                    {% endif %}
                                {% endif %}
                                {# extcommunity w/ cost #}
                                {% if set["extended_community"]["cost"] is defined %}
                                        {% set prebestpath = [] %}
                                        {% set igp = [] %}
                                    {% for cost in set["extended_community"]["cost"] %}
                                        {% if cost["community_id"] is defined and cost["cost"] is defined %}
                                            {% if cost["type_cost"] is defined and cost["type_cost"] == 'pre-bestpath' %}
                                                {% set _ = prebestpath.append("pre-bestpath " ~ cost["community_id"] ~ " " ~ cost["cost"])%}
                                            {% elif cost["type_cost"] is defined and cost["type_cost"] == 'igp' %}
                                                {% set _ = igp.append("igp " ~ cost["community_id"] ~ " " ~ cost["cost"]) %}
                                            {% else %}
                                                {% set _ = igp.append("igp " ~ cost["community_id"] ~ " " ~ cost["cost"]) %}
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                    {% if prebestpath | length > 0 and igp | length > 0 %}
  set extcommunity cost {{ prebestpath | join(" ") }} {{ igp | join(" ")}}
                                    {% elif prebestpath | length > 0 %}
  set extcommunity cost {{ prebestpath | join(" ") }}
                                    {% elif igp | length > 0 %}
  set extcommunity cost {{ igp | join(" ")}}
                                    {% endif %}
                                {% elif set["extended_community"]["evpn_rmac"] is defined %}
  set extcommunity evpn rmac {{ set["extended_community"]["evpn_rmac"] | hwaddr('cisco') }}
                                {% elif set["extended_community"]["rt"] is defined %}
                                    {% if set["extended_community"]["rt"]["additive"] is defined and set["extended_community"]["rt"]["additive"] is true%}
  set extcommunity rt {{ set["extended_community"]["rt"]["rt_list"] | join(" ") }} additive
                                    {% else %}
  set extcommunity rt {{ set["extended_community"]["rt"]["rt_list"] | join(" ") }}
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                            {% if set["forwarding_address"] is defined and set["forwarding_address"] is true %}
  set forwarding-address
                            {% endif %}
                            {% if set["interface"] is defined %}
  set interface Null0
                            {% endif %}
                            {% if set["level"] is defined %}
  set level {{ set["level"] }}
                            {% endif %}
                            {% if set["local_preference"] is defined %}
  set local-preference {{ set["local_preference"] }}
                            {% endif %}
                            {% if set["metric_type"] is defined %}
  set metric-type {{ set["metric_type"] }}
                            {% endif %}
                            {% if set["metric"] is defined %}
                                {% if set["metric"] | length == 5 %}
  set metric {{ set["metric"]["bandwidth"] }} {{ set["metric"]["delay"] }} {{ set["metric"]["reliability"] }} {{ set["metric"]["load"] }} {{ set["metric"]["mtu"]}}
                                {% elif set["metric"]["bandwidth"] is defined %}
  set metric {{ set["metric"]["bandwidth"] }}
                                {% endif %}
                            {% endif %}
                            {% if set["nssa_only"] is defined and set["nssa_only"] is true %}
  set nssa-only
                            {% endif %}
                            {% if set["origin"] is defined %}
  set origin {{ set["origin"] }}
                            {% endif %}
                            {% if set["path_selection"] is defined %}
  set path-selection {{ set["path_selection"] }} advertise
                            {% endif %}
                            {% if set["tag"] is defined %}
  set tag {{ set["tag"] }}
                            {% endif %}
                            {% if set["weight"] is defined %}
  set weight {{ set["weight"] }}
                            {% endif %}
                            {% if set["ipv4"] is defined %}
                                {% if set["ipv4"]["precedence"] is defined %}
  set ip precedence {{ set["ipv4"]["precedence"] }}
                                {% endif %}
                                {% if set["ipv4"]["address_prefix_list"] is defined %}
  set ip address prefix-list {{ set["ipv4"]["address_prefix_list"] }}
                                {% endif %}
                                {% if set["ipv4"]["next_hop"] is defined %}
                                    {% if set["ipv4"]["next_hop"]["peer_address"] is defined and set["ipv4"]["next_hop"]["peer_address"] is true %}
  set ip next-hop peer-address
                                    {% elif set["ipv4"]["next_hop"]["redist_unchanged"] is defined and set["ipv4"]["next_hop"]["redist_unchanged"] is true %}
  set ip next-hop redist-unchanged
                                    {% elif set["ipv4"]["next_hop"]["unchanged"] is defined and set["ipv4"]["next_hop"]["unchanged"] is true %}
  set ip next-hop unchanged
                                    {% else %}
                                        {% set nh_options = [] %}
                                        {% if set["ipv4"]["next_hop"]["verify_availability"] is defined and set["ipv4"]["next_hop"]["verify_availability"] is true %}
                                            {% set _ = nh_options.append("verify-availability")%}
                                        {% endif %}
                                        {% if set["ipv4"]["next_hop"]["address"] is defined %}
                                            {% set _ = nh_options.append(set["ipv4"]["next_hop"]["address"] | ipaddr('address')) %}
                                        {% endif %}
                                        {% if set["ipv4"]["next_hop"]["drop_on_fail"] is defined or set["ipv4"]["next_hop"]["load_share"] is defined or
                                        set["ipv4"]["next_hop"]["force_order"] is defined %}
                                            {% if set["ipv4"]["next_hop"]["load_share"] is true %}
                                                {% set _ = nh_options.append("load-share")%}
                                            {% endif %}
                                            {% if set["ipv4"]["next_hop"]["force_order"] is true %}
                                                {% set _ = nh_options.append("force-order")%}
                                            {% endif %}
                                            {% if set["ipv4"]["next_hop"]["drop_on_fail"] is true %}
                                                {% set _ = nh_options.append("drop-on-fail")%}
                                            {% endif %}
                                        {% endif %}
  set ip next-hop {{ nh_options | join(" ") }}
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                            {% if set["ipv6"] is defined %}
                                {% if set["ipv6"]["precedence"] is defined %}
  set ipv6 precedence {{ set["ipv6"]["precedence"] }}
                                {% endif %}
                                {% if set["ipv6"]["address_prefix_list"] is defined %}
  set ipv6 address prefix-list {{ set["ipv6"]["address_prefix_list"] }}
                                {% endif %}
                                {% if set["ipv6"]["next_hop"] is defined %}
                                    {% if set["ipv6"]["next_hop"]["peer_address"] is defined and set["ipv6"]["next_hop"]["peer_address"] is true %}
  set ipv6 next-hop peer-address
                                    {% elif set["ipv6"]["next_hop"]["redist_unchanged"] is defined and set["ipv6"]["next_hop"]["redist_unchanged"] is true
                                    %}
  set ipv6 next-hop redist-unchanged
                                    {% elif set["ipv6"]["next_hop"]["unchanged"] is defined and set["ipv6"]["next_hop"]["unchanged"] is true %}
  set ipv6 next-hop unchanged
                                    {% else %}
                                        {% set nh_options = [] %}
                                        {% if set["ipv6"]["next_hop"]["verify_availability"] is defined and set["ipv6"]["next_hop"]["verify_availability"] is
                                        true %}
                                            {% set _ = nh_options.append("verify-availability")%}
                                        {% endif %}
                                        {% if set["ipv6"]["next_hop"]["address"] is defined %}
                                            {% set _ = nh_options.append(set["ipv6"]["next_hop"]["address"] | ipaddr('address')) %}
                                        {% endif %}
                                        {% if set["ipv6"]["next_hop"]["drop_on_fail"] is defined or set["ipv6"]["next_hop"]["load_share"] is defined or
                                        set["ipv6"]["next_hop"]["force_order"] is defined %}
                                        {% if set["ipv6"]["next_hop"]["load_share"] is true %}
                                            {% set _ = nh_options.append("load-share")%}
                                        {% endif %}
                                        {% if set["ipv6"]["next_hop"]["force_order"] is true %}
                                            {% set _ = nh_options.append("force-order")%}
                                        {% endif %}
                                        {% if set["ipv6"]["next_hop"]["drop_on_fail"] is true %}
                                            {% set _ = nh_options.append("drop-on-fail")%}
                                        {% endif %}
                                    {% endif %}
  set ipv6 next-hop {{ nh_options | join(" ") }}
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endfor %}
    {% endfor %}